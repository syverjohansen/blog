<!DOCTYPE html>

<html lang="{{ .Site.LanguageCode }}">
{{ partial "head.html" . }}
{{ partial "nav.html" . }}
<!-- Page Header -->
{{ block "header" .}}
<header class="intro-header" style="background-image: url('{{ .Site.Params.header_image | relURL }}')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 ">
                <div class="site-heading">
                    <h1>{{ .Site.Title}} </h1>
                    <!--<hr class="small">-->
		    <span class="subheading">{{ .Site.Params.slogan }}</span>
                </div>
            </div>
        </div>
    </div>
</header>
{{ end }}

{{ block "main" . }}
{{ end }}

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- DataTables CSS -->

<!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"> -->
<link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-2.1.0/datatables.min.css">
<link href="https://cdn.datatables.net/v/dt/dt-2.1.0/fc-5.0.1/datatables.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<!-- DataTables JS -->
<!-- <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script> -->
<script src="https://cdn.datatables.net/v/dt/dt-2.1.0/datatables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/fixedcolumns/5.0.1/js/dataTables.fixedColumns.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.5/cdn.min.js"></script>

{{ partial "footer.html" . }}

<script>
$(document).ready(function() {
    if ($('#dataTable').length) {
        $('#dataTable').DataTable();
    }
    });

// Dynamic Catalog Generation
$(document).ready(function() {
  // Only run if the catalog container exists
  if ($('.catalog-container').length) {
    // Clear existing hardcoded items
    $('.catalog-body').empty();

    // Debug: Count all headings in the document
    var allHeadings = $('.post-container h2, .post-container h3, .post-container h4');
    console.log('[Catalog Debug] Total h2/h3/h4 headings found in document:', allHeadings.length);

    var catalogItemCount = 0;
    var usedIds = {}; // Track used IDs to avoid duplicates

    // Find all h2, h3, h4 elements in the post container (limited to h4 for performance)
    allHeadings.each(function(index) {
      var heading = $(this);

      // If the heading doesn't have an ID, create one based on the text
      if (!heading.attr('id')) {
        var baseId = heading.text().toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '');
        var headingId = baseId;

        // Make ID unique if it's already been used
        if (usedIds[headingId]) {
          usedIds[headingId]++;
          headingId = baseId + '-' + usedIds[headingId];
        } else {
          usedIds[headingId] = 1;
        }

        heading.attr('id', headingId);
      }

      // Get heading info
      var headingId = heading.attr('id');
      var headingText = heading.text();
      var headingLevel = heading.prop('tagName').toLowerCase();

      // Debug: Log first 15 items to see what's being added
      if (index < 15) {
        console.log('[Catalog Debug] Item', index, ':', headingLevel, '-', headingText, '- ID:', headingId);
      }

      // Create the list item with appropriate indentation
      var listItem = $('<li>');
      if (headingLevel === 'h3') {
        listItem.css('padding-left', '1.5rem');
      } else if (headingLevel === 'h4') {
        listItem.css('padding-left', '3rem');
      }

      // Create the link
      var link = $('<a>').attr('href', '#' + headingId).text(headingText);

      // Make h4 links bold
      if (headingLevel === 'h4') {
        link.css('font-weight', 'bold');
      }

      listItem.append(link);

      // Add to the catalog
      $('.catalog-body').append(listItem);
      catalogItemCount++;
    });

    // Debug: Report final count and first few items in DOM
    console.log('[Catalog Debug] Total items added to catalog:', catalogItemCount);
    console.log('[Catalog Debug] Items in catalog-body:', $('.catalog-body li').length);
    console.log('[Catalog Debug] First 5 catalog items in DOM:');
    $('.catalog-body li').slice(0, 5).each(function(i) {
      console.log('  ', i, ':', $(this).text(), '- href:', $(this).find('a').attr('href'));
    });
    
    // Track active section while scrolling
    $(window).scroll(function() {
      var scrollPosition = $(window).scrollTop();

      // Find the current heading (h2, h3, h4 only)
      $('.post-container h2, .post-container h3, .post-container h4').each(function() {
        var currentHeading = $(this);
        var sectionTop = currentHeading.offset().top - 100;
        var sectionId = currentHeading.attr('id');
        
        if (scrollPosition >= sectionTop) {
          // Remove active class from all links
          $('.catalog-body li').removeClass('active');
          
          // Add active class to current section link
          $('.catalog-body li a[href="#' + sectionId + '"]').parent().addClass('active');
        }
      });
    });
    
    // Scroll to section when clicking catalog links (smooth scroll)
    $('.catalog-body a').click(function(e) {
      e.preventDefault();
      var targetId = $(this).attr('href');
      $('html, body').animate({
        scrollTop: $(targetId).offset().top - 70
      }, 500);
      
      // Close mobile menu after clicking on mobile
      if (window.innerWidth <= 1200) {
        $('.sidebar-container.catalog-container').removeClass('expanded');
      }
    });
  }
  
  // Mobile catalog toggle functionality
  if (window.innerWidth <= 1200) {
    $('.sidebar-container.catalog-container').click(function(e) {
      if (!$(this).hasClass('expanded')) {
        e.preventDefault();
        $(this).addClass('expanded');
      }
    });
    
    // Close catalog when clicking outside
    $(document).click(function(e) {
      if (!$(e.target).closest('.sidebar-container.catalog-container').length) {
        $('.sidebar-container.catalog-container').removeClass('expanded');
      }
    });
    
    // Prevent closing when clicking inside the expanded catalog
    $('.sidebar-container.catalog-container.expanded').click(function(e) {
      e.stopPropagation();
    });
  }
  
  // Handle window resize
  $(window).resize(function() {
    if (window.innerWidth > 1200) {
      $('.sidebar-container.catalog-container').removeClass('expanded');
    }
  });
});


</script>



</body>
</html>
